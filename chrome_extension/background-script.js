
// Parse the stringified browser fingerprint.
// This value is filled in from Python as a template variable.
const browserFingerprint = JSON.parse("{\"server_useragent\": \"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36\", \"server_useragent_info\": \"Chrome 74.0 Blink (browser)\", \"server_useragent_os\": \"Windows 7 x64\", \"server_useragent_device\": \"desktop\", \"server_useragent_brand\": \"\", \"server_useragent_model\": \"\", \"server_ip\": \"162.140.252.10\", \"server_country\": \"United States\", \"server_city\": \"Ft. Washington\", \"server_region\": \"Maryland\", \"server_isp\": \"U.S. Government Printing Office\", \"server_asn\": \"AS3705\", \"server_lat\": 38.7592, \"server_long\": -76.9858, \"javascript_enabled\": \"true\", \"screen_width\": 2048, \"screen_height\": 864, \"innerWidth\": 1010, \"innerHeight\": 703, \"navigator_userAgent\": \"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36\", \"navigator_appVersion\": \"5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like\", \"navigator_appName\": \"Netscape\", \"navigator_appCodeName\": \"Mozilla\", \"navigator_product\": \"Gecko\", \"navigator_productSub\": \"20030107\", \"navigator_vendor\": \"Google Inc.\", \"navigator_vendorSub\": null, \"navigator_buildID\": null, \"navigator_platform\": \"Win32\", \"navigator_oscpu\": null, \"navigator_hardwareConcurrency\": 4, \"navigator_language\": \"en-US\", \"navigator_languages\": \"[\\\"en-US\\\",\\\"en\\\"]\", \"navigator_onLine\": \"true\", \"navigator_doNotTrack\": null, \"navigator_cookieEnabled\": \"1\", \"navigator_maxTouchPoints\": 0, \"navigator_activeVRDisplays\": null, \"battery_charging\": \"true\", \"battery_chargingTime\": \"0\", \"battery_dischargingTime\": null, \"battery_level\": 1.0, \"audio_state\": \"suspended\", \"audio_sampleRate\": 48000, \"audio_maxChannelCount\": 2, \"audio_numberOfInputs\": 1, \"audio_numberOfOutputs\": 0, \"audio_channelCount\": 2, \"audio_channelCountMode\": \"explicit\", \"audio_channelInterpretation\": \"speakers\", \"audio_fftSize\": 2048, \"audio_frequencyBinCount\": 1024, \"audio_minDecibels\": -100, \"audio_maxDecibels\": -30, \"audio_smoothingTimeConstant\": 0.8, \"permission_geolocation\": \"denied\", \"permission_notifications\": \"prompt\", \"permission_midi\": \"granted\", \"permission_midiSysEx\": \"prompt\", \"permission_push\": \"prompt\", \"navigator_javaEnabled\": \"false\", \"navigator_getGamepads\": \"[]\", \"navigator_getVRDisplays\": \"[]\", \"navigator_taintEnabled\": null, \"navigator_mimeTypes\": \"[{\\\"description\\\":\\\"\\\",\\\"suffixes\\\":\\\"pdf\\\",\\\"type\\\":\\\"application\\\\/pdf\\\",\\\"enabledPlugin\\\":{\\\"description\\\":\\\"\\\",\\\"filename\\\":\\\"mhjfbmdgcfjbbpaeojofohoefgiehjai\\\",\\\"length\\\":1,\\\"name\\\":\\\"Chrome PDF Viewer\\\"}},{\\\"description\\\":\\\"Portable Document Format\\\",\\\"suffixes\\\":\\\"pdf\\\",\\\"type\\\":\\\"application\\\\/x-google-chrome-pdf\\\",\\\"enabledPlugin\\\":{\\\"description\\\":\\\"Portable Document Format\\\",\\\"filename\\\":\\\"internal-pdf-viewer\\\",\\\"length\\\":1,\\\"name\\\":\\\"Chrome PDF Plugin\\\"}},{\\\"description\\\":\\\"Native Client Executable\\\",\\\"suffixes\\\":\\\"\\\",\\\"type\\\":\\\"application\\\\/x-nacl\\\",\\\"enabledPlugin\\\":{\\\"description\\\":\\\"\\\",\\\"filename\\\":\\\"internal-nacl-plugin\\\",\\\"length\\\":2,\\\"name\\\":\\\"Native Client\\\"}},{\\\"description\\\":\\\"Portable Native Client Executable\\\",\\\"suffixes\\\":\\\"\\\",\\\"type\\\":\\\"application\\\\/x-pnacl\\\",\\\"enabledPlugin\\\":{\\\"description\\\":\\\"\\\",\\\"filename\\\":\\\"internal-nacl-plugin\\\",\\\"length\\\":2,\\\"name\\\":\\\"Native Client\\\"}}]\", \"navigator_plugins\": \"[{\\\"description\\\":\\\"Portable Document Format\\\",\\\"filename\\\":\\\"internal-pdf-viewer\\\",\\\"length\\\":1,\\\"name\\\":\\\"Chrome PDF Plugin\\\",\\\"mimeTypes\\\":[{\\\"description\\\":\\\"Portable Document Format\\\",\\\"suffixes\\\":\\\"pdf\\\",\\\"type\\\":\\\"application\\\\/x-google-chrome-pdf\\\"}]},{\\\"description\\\":\\\"\\\",\\\"filename\\\":\\\"mhjfbmdgcfjbbpaeojofohoefgiehjai\\\",\\\"length\\\":1,\\\"name\\\":\\\"Chrome PDF Viewer\\\",\\\"mimeTypes\\\":[{\\\"description\\\":\\\"\\\",\\\"suffixes\\\":\\\"pdf\\\",\\\"type\\\":\\\"application\\\\/pdf\\\"}]},{\\\"description\\\":\\\"\\\",\\\"filename\\\":\\\"internal-nacl-plugin\\\",\\\"length\\\":2,\\\"name\\\":\\\"Native Client\\\",\\\"mimeTypes\\\":[{\\\"description\\\":\\\"Native Client Executable\\\",\\\"suffixes\\\":\\\"\\\",\\\"type\\\":\\\"application\\\\/x-nacl\\\"},{\\\"description\\\":\\\"Portable Native Client Executable\\\",\\\"suffixes\\\":\\\"\\\",\\\"type\\\":\\\"application\\\\/x-pnacl\\\"}]}]\", \"navigator_mediaDevices\": \"[]\", \"navigator_credentials\": null, \"navigator_webdriver\": null, \"navigator_storage_enabled\": \"true\", \"navigator_storage_estimate\": null, \"navigator_storage_persist\": null, \"navigator_storage_persisted\": null, \"geolocation_latitude\": null, \"geolocation_longitude\": null, \"geolocation_accuracy\": null, \"geolocation_cacheAge\": null, \"webgl_webGLSupport\": \"true\", \"webgl_webGL2Support\": \"true\", \"webgl_supportedContextNames\": \"[\\\"webgl2\\\",\\\"webgl\\\",\\\"experimental-webgl\\\"]\", \"webgl_version\": \"WebGL 2.0 (OpenGL ES 3.0 Chromium)\", \"webgl_shadingLanguageVersion\": \"WebGL GLSL ES 3.00 (OpenGL ES GLSL ES 3.0 Chromium)\", \"webgl_vendor\": \"WebKit\", \"webgl_renderer\": \"WebKit WebGL\", \"webgl_antialiasing\": \"true\", \"webgl_ANGLE\": \"false\", \"webgl_majorPerformanceCaveat\": \"false\", \"webgl_unmaskedVendor\": \"Google Inc.\", \"webgl_unmaskedRenderer\": \"ANGLE (Intel(R) HD Graphics 5500 Direct3D11 vs_5_0 ps_5_0)\", \"webrtc_RTCPeerConnection\": \"true\", \"webrtc_RTCDataChannel\": \"true\", \"webrtc_ORTC\": \"false\", \"webrtc_deviceEnumeration\": \"true\", \"webrtc_hasMicrophone\": \"true\", \"webrtc_hasCamera\": \"true\", \"webrtc_mediaDevices\": \"[{\\\"deviceId\\\":\\\"default\\\",\\\"groupId\\\":\\\"1bd5c3829aa53dffa5db75a9fc4b3352bd9a902b1a5eb3884f6c05ea4181b1ec\\\",\\\"kind\\\":\\\"audioinput\\\",\\\"label\\\":null},{\\\"deviceId\\\":\\\"communications\\\",\\\"groupId\\\":\\\"1bd5c3829aa53dffa5db75a9fc4b3352bd9a902b1a5eb3884f6c05ea4181b1ec\\\",\\\"kind\\\":\\\"audioinput\\\",\\\"label\\\":null},{\\\"deviceId\\\":\\\"e68d933031fcc5179adb0ca8bd143bcd9bbffc07edd50503e4abda7823ea69b3\\\",\\\"groupId\\\":\\\"1bd5c3829aa53dffa5db75a9fc4b3352bd9a902b1a5eb3884f6c05ea4181b1ec\\\",\\\"kind\\\":\\\"audioinput\\\",\\\"label\\\":null},{\\\"deviceId\\\":\\\"23a82d635edad2abbf626ba0d0ad4e725553dced5cdd0732743c700e51f2a525\\\",\\\"groupId\\\":\\\"720da4dede6c490a2f15baf6cf721259b05ab7be23f500fb90a430126874084a\\\",\\\"kind\\\":\\\"videoinput\\\",\\\"label\\\":null},{\\\"deviceId\\\":\\\"default\\\",\\\"groupId\\\":\\\"1bd5c3829aa53dffa5db75a9fc4b3352bd9a902b1a5eb3884f6c05ea4181b1ec\\\",\\\"kind\\\":\\\"audiooutput\\\",\\\"label\\\":null},{\\\"deviceId\\\":\\\"communications\\\",\\\"groupId\\\":\\\"1bd5c3829aa53dffa5db75a9fc4b3352bd9a902b1a5eb3884f6c05ea4181b1ec\\\",\\\"kind\\\":\\\"audiooutput\\\",\\\"label\\\":null},{\\\"deviceId\\\":\\\"ed6ccc0aab0ab1bd4c2457c685a49c549a55f09eeeb345ed44933ec6b6fb2ee2\\\",\\\"groupId\\\":\\\"1bd5c3829aa53dffa5db75a9fc4b3352bd9a902b1a5eb3884f6c05ea4181b1ec\\\",\\\"kind\\\":\\\"audiooutput\\\",\\\"label\\\":null}]\", \"webrtc_localIP\": \"172.20.253.223\", \"canvas_supported\": \"true\", \"canvas_textAPI\": \"true\", \"canvas_toDataURL\": \"true\", \"gyroscope_supported\": null, \"gyroscope_isMoving\": null, \"gyroscope_x\": null, \"gyroscope_y\": null, \"gyroscope_z\": null, \"gyroscope_xWithGravity\": null, \"gyroscope_yWithGravity\": null, \"gyroscope_zWithGravity\": null, \"gyroscope_rotationAlpha\": null, \"gyroscope_rotationBeta\": null, \"gyroscope_rotationGamma\": null, \"gyroscope_interval\": null, \"connection\": \"{\\\"effectiveType\\\":\\\"4g\\\",\\\"rtt\\\":100,\\\"downlink\\\":10,\\\"saveData\\\":false}\", \"connection_type\": null, \"connection_effectiveType\": \"4g\", \"connection_downlink\": 10.0, \"connection_downlinkMax\": null, \"connection_rtt\": 100, \"connection_saveData\": \"false\", \"fonts\": \"[\\\"Arial\\\",\\\"Arial Black\\\",\\\"Arial Narrow\\\",\\\"Arial Unicode MS\\\",\\\"Book Antiqua\\\",\\\"Bookman Old Style\\\",\\\"Calibri\\\",\\\"Cambria\\\",\\\"Cambria Math\\\",\\\"Century\\\",\\\"Century Gothic\\\",\\\"Century Schoolbook\\\",\\\"Comic Sans MS\\\",\\\"Consolas\\\",\\\"Courier\\\",\\\"Courier New\\\",\\\"Georgia\\\",\\\"Helvetica\\\",\\\"Impact\\\",\\\"Lucida Bright\\\",\\\"Lucida Calligraphy\\\",\\\"Lucida Console\\\",\\\"Lucida Fax\\\",\\\"Lucida Handwriting\\\",\\\"Lucida Sans\\\",\\\"Lucida Sans Typewriter\\\",\\\"Lucida Sans Unicode\\\",\\\"Microsoft Sans Serif\\\",\\\"Monotype Corsiva\\\",\\\"MS Gothic\\\",\\\"MS PGothic\\\",\\\"MS Reference Sans Serif\\\",\\\"MS Sans Serif\\\",\\\"MS Serif\\\",\\\"Palatino Linotype\\\",\\\"Segoe Print\\\",\\\"Segoe Script\\\",\\\"Segoe UI\\\",\\\"Segoe UI Light\\\",\\\"Segoe UI Semibold\\\",\\\"Segoe UI Symbol\\\",\\\"Tahoma\\\",\\\"Times\\\",\\\"Times New Roman\\\",\\\"Trebuchet MS\\\",\\\"Verdana\\\",\\\"Wingdings\\\",\\\"Wingdings 2\\\",\\\"Wingdings 3\\\",\\\"Agency FB\\\",\\\"Aharoni\\\",\\\"Algerian\\\",\\\"Andalus\\\",\\\"Angsana New\\\",\\\"AngsanaUPC\\\",\\\"Aparajita\\\",\\\"Arabic Typesetting\\\",\\\"Baskerville Old Face\\\",\\\"Batang\\\",\\\"BatangChe\\\",\\\"Bauhaus 93\\\",\\\"Bell MT\\\",\\\"Berlin Sans FB\\\",\\\"Bernard MT Condensed\\\",\\\"Blackadder ITC\\\",\\\"Bodoni MT\\\",\\\"Bodoni MT Black\\\",\\\"Bodoni MT Condensed\\\",\\\"Bookshelf Symbol 7\\\",\\\"Bradley Hand ITC\\\",\\\"Broadway\\\",\\\"Browallia New\\\",\\\"BrowalliaUPC\\\",\\\"Brush Script MT\\\",\\\"Californian FB\\\",\\\"Calisto MT\\\",\\\"Candara\\\",\\\"Castellar\\\",\\\"Centaur\\\",\\\"Chiller\\\",\\\"Colonna MT\\\",\\\"Constantia\\\",\\\"Cooper Black\\\",\\\"Copperplate Gothic\\\",\\\"Copperplate Gothic Light\\\",\\\"Corbel\\\",\\\"Cordia New\\\",\\\"CordiaUPC\\\",\\\"Curlz MT\\\",\\\"DaunPenh\\\",\\\"David\\\",\\\"DFKai-SB\\\",\\\"DilleniaUPC\\\",\\\"DokChampa\\\",\\\"Dotum\\\",\\\"DotumChe\\\",\\\"Ebrima\\\",\\\"Edwardian Script ITC\\\",\\\"Elephant\\\",\\\"Engravers MT\\\",\\\"EucrosiaUPC\\\",\\\"Euphemia\\\",\\\"FangSong\\\",\\\"Felix Titling\\\",\\\"Footlight MT Light\\\",\\\"Forte\\\",\\\"FrankRuehl\\\",\\\"FreesiaUPC\\\",\\\"Freestyle Script\\\",\\\"French Script MT\\\",\\\"Gabriola\\\",\\\"Gautami\\\",\\\"Gigi\\\",\\\"Gill Sans MT\\\",\\\"Gill Sans MT Condensed\\\",\\\"Gisha\\\",\\\"Goudy Old Style\\\",\\\"Goudy Stout\\\",\\\"Gulim\\\",\\\"GulimChe\\\",\\\"Gungsuh\\\",\\\"GungsuhChe\\\",\\\"Haettenschweiler\\\",\\\"Harrington\\\",\\\"High Tower Text\\\",\\\"Imprint MT Shadow\\\",\\\"Informal Roman\\\",\\\"IrisUPC\\\",\\\"Iskoola Pota\\\",\\\"JasmineUPC\\\",\\\"Jokerman\\\",\\\"Juice ITC\\\",\\\"KaiTi\\\",\\\"Kalinga\\\",\\\"Kartika\\\",\\\"Khmer UI\\\",\\\"KodchiangUPC\\\",\\\"Kokila\\\",\\\"Kristen ITC\\\",\\\"Kunstler Script\\\",\\\"Lao UI\\\",\\\"Latha\\\",\\\"Leelawadee\\\",\\\"Levenim MT\\\",\\\"LilyUPC\\\",\\\"Magneto\\\",\\\"Maiandra GD\\\",\\\"Malgun Gothic\\\",\\\"Mangal\\\",\\\"Marlett\\\",\\\"Matura MT Script Capitals\\\",\\\"Meiryo\\\",\\\"Meiryo UI\\\",\\\"Microsoft Himalaya\\\",\\\"Microsoft JhengHei\\\",\\\"Microsoft New Tai Lue\\\",\\\"Microsoft PhagsPa\\\",\\\"Microsoft Tai Le\\\",\\\"Microsoft Uighur\\\",\\\"Microsoft YaHei\\\",\\\"Microsoft Yi Baiti\\\",\\\"MingLiU\\\",\\\"MingLiU_HKSCS\\\",\\\"MingLiU_HKSCS-ExtB\\\",\\\"MingLiU-ExtB\\\",\\\"Miriam\\\",\\\"Miriam Fixed\\\",\\\"Mistral\\\",\\\"Modern No. 20\\\",\\\"Mongolian Baiti\\\",\\\"MoolBoran\\\",\\\"MS Mincho\\\",\\\"MS PMincho\\\",\\\"MS Reference Specialty\\\",\\\"MS UI Gothic\\\",\\\"MV Boli\\\",\\\"Narkisim\\\",\\\"Niagara Engraved\\\",\\\"Niagara Solid\\\",\\\"NSimSun\\\",\\\"Nyala\\\",\\\"Old English Text MT\\\",\\\"Onyx\\\",\\\"Palace Script MT\\\",\\\"Papyrus\\\",\\\"Parchment\\\",\\\"Perpetua\\\",\\\"Perpetua Titling MT\\\",\\\"Plantagenet Cherokee\\\",\\\"Playbill\\\",\\\"PMingLiU\\\",\\\"PMingLiU-ExtB\\\",\\\"Poor Richard\\\",\\\"Pristina\\\",\\\"Raavi\\\",\\\"Ravie\\\",\\\"Rockwell\\\",\\\"Rockwell Condensed\\\",\\\"Rod\\\",\\\"Sakkal Majalla\\\",\\\"Shonar Bangla\\\",\\\"Showcard Gothic\\\",\\\"Shruti\\\",\\\"SimHei\\\",\\\"Simplified Arabic\\\",\\\"Simplified Arabic Fixed\\\",\\\"SimSun\\\",\\\"SimSun-ExtB\\\",\\\"Snap ITC\\\",\\\"Stencil\\\",\\\"Sylfaen\\\",\\\"Tempus Sans ITC\\\",\\\"Traditional Arabic\\\",\\\"Tunga\\\",\\\"Tw Cen MT\\\",\\\"Tw Cen MT Condensed\\\",\\\"Utsaah\\\",\\\"Vani\\\",\\\"Vijaya\\\",\\\"Viner Hand ITC\\\",\\\"Vivaldi\\\",\\\"Vladimir Script\\\",\\\"Vrinda\\\",\\\"Wide Latin\\\"]\"}");

// Extract the user agent string.
const userAgent = browserFingerprint.server_useragent || browserFingerprint.userAgent;

// Define a function for mutating the request headers.
const replaceUserAgentHeader = ({ requestHeaders }) => {
  requestHeaders
    .filter(header => /user-agent/i.test(header.name))
    .forEach(header => header.value = userAgent);
  return { requestHeaders };
};

// Intercept all web requests and mutate the headers to have the correct user agent.
(chrome || browser).webRequest.onBeforeSendHeaders.addListener(
  replaceUserAgentHeader,
  { urls: ['<all_urls>'], },
  ['blocking', 'requestHeaders']
);
